var sv,ScriptsVari={settings:{$body:$("body"),$html:$("html")},init:function(){sv=this.settings,this.bindUIActions(),this.onLoadActions(),this.scrollActions(),this.resizeActions()},onLoadActions:function(){$(window).load(function(){})},bindUIActions:function(){var n=$("#datetimepicker1").find("input").data("limit");$("#datetimepicker1").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",stepping:10,maxDate:n}),$("#map").length>0&&(ScriptsVari.initMap(),ScriptsVari.initMap2())},scrollActions:function(){$(window).scroll(function(){})},resizeActions:function(){$(window).resize(function(){}).resize()},initMap:function(){$("#info");var n,i=$("#map"),e=function(){i.height(i.parent(".map-wrapper").outerHeight()),n&&n.invalidateSize()};$(window).on("resize",function(){e()}),e(),n=L.map("map").setView([44.715514,-112.148438],4);new L.StamenTileLayer("toner",{detectRetina:!0}).addTo(n);var t=L.control.layers().addTo(n),o=L.control.legend({autoAdd:!1}).addTo(n),r=L.GeometryUtils.arrayToMap(airports,"code");console.log(r),flights=_.sortBy(flights,function(n){return-1*n.Counts}),console.log(flights);var a=_.groupBy(flights,function(n){return n.UniqueCarrier});console.log(a);var l=Number(flights[0].Counts);console.log("max count all:"+l),flights=_.filter(flights,function(n){return"all"!==n.UniqueCarrier}),console.log(flights);var c=Number(flights[0].Counts);console.log("max count:"+c);var s=0,u=new L.LinearFunction([1,16],[253,48]),d={recordsField:null,locationMode:L.LocationModes.CUSTOM,fromField:"Origin",toField:"Dest",codeField:null,getLocation:function(n,i,e,t){var o,a=e[0],l=r[a];if(l){var c=new L.LatLng(Number(l.lat),Number(l.lon));o={location:c,text:a,center:c}}return o},getEdge:L.Graph.EDGESTYLE.ARC,includeLayer:function(n){return!1},getIndexKey:function(n,i){return i.Origin+"_"+i.Dest},setHighlight:function(n){return n.opacity=1,n},unsetHighlight:function(n){return n.opacity=.5,n},layerOptions:{fill:!1,opacity:.8,weight:.4,fillOpacity:1,distanceToHeight:new L.LinearFunction([0,20],[1e3,300]),mode:"C",markers:{end:!0}},legendOptions:{width:200,numSegments:5,className:"legend-line"},tooltipOptions:{iconSize:new L.Point(80,64),iconAnchor:new L.Point(-5,64),className:"leaflet-div-icon line-legend"},displayOptions:{Counts:{weight:new L.LinearFunction([0,1],[c,14]),color:new L.HSLHueFunction([0,100],[c,0],{outputSaturation:"80%",outputLuminosity:"50%"}),displayName:"Flights Out of Origin to Destination"}},onEachRecord:function(n,i,e){n.bindPopup($(L.HTMLUtils.buildTable(i)).wrap("<div/>").parent().html()),e.location.animateLine({duration:5e3*Math.random()+500,easing:L.AnimationUtils.easingFunctions.easeOut})}},g=new L.Graph(flights,d);console.log(g),n.addLayer(g);var p=new L.MarkerDataLayer(r,{recordsField:null,locationMode:L.LocationModes.LATLNG,latitudeField:"lat",longitudeField:"lon",displayOptions:{direct_flights:{color:new L.HSLHueFunction([0,200],[253,330],{outputLuminosity:"60%"})},code:{title:function(n){return n}}},layerOptions:{fill:!1,stroke:!1,weight:0,color:"#A0A0A0"},filter:function(n){return Number(n.carriers)>3},setIcon:function(n,i){var e='<div><i class="fa fa-circle-thin"></i><span class="code">'+n.code+"</span></div>",t=$(e),o=t.find("i");L.StyleConverter.applySVGStyle(o.get(0),i);var r=L.Util.getFieldValue(n,"direct_flights"),a=u.evaluate(r);o.width(a),o.height(a),o.css("font-size",a+"px"),o.css("line-height",a+"px");var l=t.find(".code");return l.width(a),l.height(a),l.css("line-height",a+"px"),l.css("font-size",a/3+"px"),l.css("margin-top",-a/2+"px"),new L.DivIcon({iconSize:new L.Point(a,a),iconAnchor:new L.Point(a/2,a/2),className:"airport-icon",html:t.wrap("<div/>").parent().html()})},onEachRecord:function(n,i){n.on("mouseover",function(){console.log(i),g.options.includeLayer=function(n){return n.Origin===i.code},g.reloadData()})}});n.addLayer(p),t.addOverlay(p,"Airports");for(var f in a)if("all"!==f){var h=L.extend(d,{includeLayer:function(n){return n.UniqueCarrier===f}}),m=new L.Graph(flights,h);t.addOverlay(m,f),0===s&&o.addLayer(m),s++}},initMap2:function(){$("#info-2");var n,i=$("#map-2"),e=function(){i.height(i.parent(".map-wrapper").outerHeight()),n&&n.invalidateSize()};$(window).on("resize",function(){e()}),e(),n=L.map("map-2").setView([44.715514,-112.148438],4);new L.StamenTileLayer("toner",{detectRetina:!0}).addTo(n);var t=L.control.layers().addTo(n),o=L.control.legend({autoAdd:!1}).addTo(n),r=L.GeometryUtils.arrayToMap(airports,"code");console.log(r),flights=_.sortBy(flights,function(n){return-1*n.Counts}),console.log(flights);var a=_.groupBy(flights,function(n){return n.UniqueCarrier});console.log(a);var l=Number(flights[0].Counts);console.log("max count all:"+l),flights=_.filter(flights,function(n){return"all"!==n.UniqueCarrier}),console.log(flights);var c=Number(flights[0].Counts);console.log("max count:"+c);var s=0,u=new L.LinearFunction([1,16],[253,48]),d={recordsField:null,locationMode:L.LocationModes.CUSTOM,fromField:"Origin",toField:"Dest",codeField:null,getLocation:function(n,i,e,t){var o,a=e[0],l=r[a];if(l){var c=new L.LatLng(Number(l.lat),Number(l.lon));o={location:c,text:a,center:c}}return o},getEdge:L.Graph.EDGESTYLE.ARC,includeLayer:function(n){return!1},getIndexKey:function(n,i){return i.Origin+"_"+i.Dest},setHighlight:function(n){return n.opacity=1,n},unsetHighlight:function(n){return n.opacity=.5,n},layerOptions:{fill:!1,opacity:.8,weight:.4,fillOpacity:1,distanceToHeight:new L.LinearFunction([0,20],[1e3,300]),mode:"C",markers:{end:!0}},legendOptions:{width:200,numSegments:5,className:"legend-line"},tooltipOptions:{iconSize:new L.Point(80,64),iconAnchor:new L.Point(-5,64),className:"leaflet-div-icon line-legend"},displayOptions:{Counts:{weight:new L.LinearFunction([0,1],[c,14]),color:new L.HSLHueFunction([0,100],[c,0],{outputSaturation:"80%",outputLuminosity:"50%"}),displayName:"Flights Out of Origin to Destination"}},onEachRecord:function(n,i,e){n.bindPopup($(L.HTMLUtils.buildTable(i)).wrap("<div/>").parent().html()),e.location.animateLine({duration:5e3*Math.random()+500,easing:L.AnimationUtils.easingFunctions.easeOut})}},g=new L.Graph(flights,d);console.log(g),n.addLayer(g);var p=new L.MarkerDataLayer(r,{recordsField:null,locationMode:L.LocationModes.LATLNG,latitudeField:"lat",longitudeField:"lon",displayOptions:{direct_flights:{color:new L.HSLHueFunction([0,200],[253,330],{outputLuminosity:"60%"})},code:{title:function(n){return n}}},layerOptions:{fill:!1,stroke:!1,weight:0,color:"#A0A0A0"},filter:function(n){return Number(n.carriers)>3},setIcon:function(n,i){var e='<div><i class="fa fa-circle-thin"></i><span class="code">'+n.code+"</span></div>",t=$(e),o=t.find("i");L.StyleConverter.applySVGStyle(o.get(0),i);var r=L.Util.getFieldValue(n,"direct_flights"),a=u.evaluate(r);o.width(a),o.height(a),o.css("font-size",a+"px"),o.css("line-height",a+"px");var l=t.find(".code");return l.width(a),l.height(a),l.css("line-height",a+"px"),l.css("font-size",a/3+"px"),l.css("margin-top",-a/2+"px"),new L.DivIcon({iconSize:new L.Point(a,a),iconAnchor:new L.Point(a/2,a/2),className:"airport-icon",html:t.wrap("<div/>").parent().html()})},onEachRecord:function(n,i){n.on("mouseover",function(){console.log(i),g.options.includeLayer=function(n){return n.Origin===i.code},g.reloadData()})}});n.addLayer(p),t.addOverlay(p,"Airports");for(var f in a)if("all"!==f){var h=L.extend(d,{includeLayer:function(n){return n.UniqueCarrier===f}}),m=new L.Graph(flights,h);t.addOverlay(m,f),0===s&&o.addLayer(m),s++}}};jQuery(document).ready(function(n){ScriptsVari.init()});